#!/bin/bash

export CLASSPATH=$CLASSPATH:`ls -1 jars/*.jar jars/worldwind/*.jar | xargs | sed "s/ /:/g"`:.
OSNAME=`uname`

if [ 'Linux' == "$OSNAME" ]; then
    DOCK=
else
    DOCK="-Xdock:name='Horizon Server' -Xdock:icon=img/logo.png"
fi

clean() {
    echo "Clean old classfiles" 1>&2
    rm org/haldean/chopper/server/*.class
    echo "Clean backup java files" 1>&2
    rm org/haldean/chopper/server/*.java\~
}

if [ 'clean' == "$1" ]; then
    clean
    exit
fi

clean

if [ 'pack' == "$1" ]; then
    echo "Creating archive" 1>&2
    tar -czf server.tar.gz org unit
else
    javac org/haldean/chopper/server/ServerHost.java -Xlint:deprecation && \
	echo "Compiled" 1>&2 && \
	java -Djava.library.path=/lib/:jars/worldwind/:jars/ $DOCK -Xmx512m \
	-Dsun.java2d.noddraw=true org.haldean.chopper.server.ServerHost \
	-h "pices.dynalias.org:23" -d # These are the program options
fi